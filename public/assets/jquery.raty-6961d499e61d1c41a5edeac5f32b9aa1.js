/*!
 * jQuery Raty - A Star Rating Plugin - http://wbotelhos.com/raty
 * ---------------------------------------------------------------------
 *
 * jQuery Raty is a plugin that generates a customizable star rating.
 *
 * Licensed under The MIT License
 *
 * @version        2.1.0
 * @since          2010.06.11
 * @author         Washington Botelho
 * @documentation  wbotelhos.com/raty
 * @twitter        twitter.com/wbotelhos
 *
 * Usage with default values:
 * ---------------------------------------------------------------------
 * $('#star').raty();
 *
 * <div id="star"></div>
 *
 * $('.star').raty();
 *
 * <div class="star"></div>
 * <div class="star"></div>
 * <div class="star"></div>
 *
 */
(function(e){var t={init:function(n){return this.each(function(){var r=e(this);this.opt=e.extend(!0,{},e.fn.raty.defaults,n),this.opt.number>20?this.opt.number=20:this.opt.number<0&&(this.opt.number=0),this.opt.path.substring(this.opt.path.length-1,this.opt.path.length)!="/"&&(this.opt.path+="/"),typeof this.opt.start=="function"&&(this.opt.start=this.opt.start.call(this));var i=!isNaN(parseInt(this.opt.start,10)),s="";i&&(s=this.opt.start>this.opt.number?this.opt.number:this.opt.start);var o=this.opt.starOn,u=this.opt.space?4:0,a="";for(var f=1;f<=this.opt.number;f++)o=s<f?this.opt.starOff:this.opt.starOn,a=f<=this.opt.hintList.length&&this.opt.hintList[f-1]!==null?this.opt.hintList[f-1]:f,r.append('<img src="'+this.opt.path+o+'" alt="'+f+'" title="'+a+'" />'),this.opt.space&&r.append(f<this.opt.number?"&#160;":"");var l=e("<input/>",{type:"hidden",name:this.opt.scoreName}).appendTo(this);i&&(this.opt.start>0&&l.val(s),t.roundStar.call(this,s)),this.opt.iconRange&&t.fillStar.call(this,s),t.setTarget.call(this,s,this.opt.targetKeep);var c=this.opt.width||this.opt.number*this.opt.size+this.opt.number*u;if(this.opt.cancel){var h=e('<img src="'+this.opt.path+this.opt.cancelOff+'" alt="x" title="'+this.opt.cancelHint+'" class="raty-cancel"/>');this.opt.cancelPlace=="left"?r.prepend("&#160;").prepend(h):r.append("&#160;").append(h),c+=this.opt.size+u}this.opt.readOnly?(t.fixHint.call(this),r.children(".raty-cancel").hide()):(r.css("cursor","pointer"),t.bindAction.call(this)),r.css("width",c)})},bindAction:function(){var n=this,r=e(n),i=r.children("input");r.mouseleave(function(){t.initialize.call(n,i.val()),t.setTarget.call(n,i.val(),n.opt.targetKeep)});var s=r.children("img").not(".raty-cancel"),o=n.opt.half?"mousemove":"mouseover";n.opt.cancel&&r.children(".raty-cancel").mouseenter(function(){e(this).attr("src",n.opt.path+n.opt.cancelOn),s.attr("src",n.opt.path+n.opt.starOff),t.setTarget.call(n,null,!0)}).mouseleave(function(){e(this).attr("src",n.opt.path+n.opt.cancelOff),r.mouseout()}).click(function(e){i.removeAttr("value"),n.opt.click&&n.opt.click.call(n,null,e)}),s.bind(o,function(i){var s=parseInt(this.alt,10);if(n.opt.half){var o=parseFloat((i.pageX-e(this).offset().left)/n.opt.size),u=o>.5?1:.5;s=parseFloat(this.alt)-1+u,t.fillStar.call(n,s),n.opt.precision&&(s=s-u+o),t.showHalf.call(n,s)}else t.fillStar.call(n,s);r.data("score",s),t.setTarget.call(n,s,!0)}).click(function(e){i.val(n.opt.half||n.opt.precision?r.data("score"):this.alt),n.opt.click&&n.opt.click.call(n,i.val(),e)})},cancel:function(n){return e(this).each(function(){var r=e(this);if(r.data("readonly")=="readonly")return!1;n?t.click.call(this,null):t.start.call(this,null),r.mouseleave().children("input").removeAttr("value")})},click:function(n){return e(this).each(function(){if(e(this).data("readonly")=="readonly")return!1;t.initialize.call(this,n),this.opt.click?this.opt.click.call(this,n):e.error('you must add the "click: function(score, evt) { }" callback.'),t.setTarget.call(this,n,!0)})},fillStar:function(t){var n=this,r=e(n),i=r.children("img").not(".raty-cancel"),s=i.length,o=0,u,a,f;for(var l=1;l<=s;l++)u=i.eq(l-1),n.opt.iconRange&&n.opt.iconRange.length>o?(a=n.opt.iconRange[o],n.opt.single?f=l==t?a.on||n.opt.starOn:a.off||n.opt.starOff:f=l<=t?a.on||n.opt.starOn:a.off||n.opt.starOff,l<=a.range&&u.attr("src",n.opt.path+f),l==a.range&&o++):(n.opt.single?f=l==t?n.opt.starOn:n.opt.starOff:f=l<=t?n.opt.starOn:n.opt.starOff,u.attr("src",n.opt.path+f))},fixHint:function(){var t=this,n=e(t),r=n.children("input"),i=parseInt(r.val(),10),s=t.opt.noRatedMsg;!isNaN(i)&&i>0&&(s=i<=t.opt.hintList.length&&t.opt.hintList[i-1]!==null?t.opt.hintList[i-1]:i),r.attr("readonly","readonly"),n.css("cursor","default").data("readonly","readonly").attr("title",s).children("img").attr("title",s)},readOnly:function(n){return e(this).each(function(){var r=e(this),i=r.children(".raty-cancel");i.length&&(n?i.hide():i.show()),n?(r.unbind(),r.children("img").unbind(),t.fixHint.call(this)):(t.bindAction.call(this),t.unfixHint.call(this))})},roundStar:function(t){var n=(t-Math.floor(t)).toFixed(2);if(n>this.opt.round.down){var r=this.opt.starOn;n<this.opt.round.up&&this.opt.halfShow?r=this.opt.starHalf:n<this.opt.round.full&&(r=this.opt.starOff),e(this).children("img").not(".raty-cancel").eq(Math.ceil(t)-1).attr("src",this.opt.path+r)}},score:function(){var t=[],n;return e(this).each(function(){n=e(this).children("input").val(),n=n==""?null:parseFloat(n),t.push(n)}),t.length>1?t:t[0]},setTarget:function(t,n){if(this.opt.target){var r=e(this.opt.target);if(r.length==0)e.error("target selector invalid or missing!");else{var i=t;i==null&&!this.opt.cancel?e.error('you must enable the "cancel" option to set hint on target.'):(!n||i==""?i=this.opt.targetText:this.opt.targetType=="hint"?i===null&&this.opt.cancel?i=this.opt.cancelHint:i=this.opt.hintList[Math.ceil(i-1)]:i!=""&&!this.opt.precision?i=parseInt(i,10):i=parseFloat(i).toFixed(1),this.opt.targetFormat.indexOf("{score}")<0?e.error('template "{score}" missing!'):t!==null&&(i=this.opt.targetFormat.toString().replace("{score}",i)),r.is(":input")?r.val(i):r.html(i))}}},showHalf:function(t){var n=(t-Math.floor(t)).toFixed(1);n>0&&n<.6&&e(this).children("img").not(".raty-cancel").eq(Math.ceil(t)-1).attr("src",this.opt.path+this.opt.starHalf)},start:function(n){return e(this).each(function(){if(e(this).data("readonly")=="readonly")return!1;t.initialize.call(this,n),t.setTarget.call(this,n,!0)})},initialize:function(n){n<0?n=0:n>this.opt.number&&(n=this.opt.number),t.fillStar.call(this,n),n!=""&&(this.opt.halfShow&&t.roundStar.call(this,n),e(this).children("input").val(n))},unfixHint:function(){var t=e(this),n=t.children("img").filter(":not(.raty-cancel)");for(var r=0;r<this.opt.number;r++)n.eq(r).attr("title",r<this.opt.hintList.length&&this.opt.hintList[r]!==null?this.opt.hintList[r]:r);t.css("cursor","pointer").removeData("readonly").removeAttr("title").children("input").attr("readonly","readonly")}};e.fn.raty=function(n){if(t[n])return t[n].apply(this,Array.prototype.slice.call(arguments,1));if(typeof n=="object"||!n)return t.init.apply(this,arguments);e.error("Method "+n+" does not exist!")},e.fn.raty.defaults={cancel:!1,cancelHint:"cancel this rating!",cancelOff:"cancel-off.png",cancelOn:"cancel-on.png",cancelPlace:"left",click:undefined,half:!1,halfShow:!0,hintList:["bad","poor","regular","good","gorgeous"],iconRange:undefined,noRatedMsg:"not rated yet",number:5,path:"/images/raty/",precision:!1,round:{down:.25,full:.6,up:.76},readOnly:!1,scoreName:"score",single:!1,size:16,space:!0,starHalf:"star-half.png",starOff:"star-off.png",starOn:"star-on.png",start:0,target:undefined,targetFormat:"{score}",targetKeep:!1,targetText:"",targetType:"hint",width:undefined}})(jQuery);