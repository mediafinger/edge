- p = @profile_rating.profile
- avg_rating = p.profile_ratings.average('rating') ? p.profile_ratings.average('rating').round : 0      

%h2= "avg_rating of " + p.name 

- profile_id = params[:profile_id]
= form_for(@profile_rating, :url => "/profiles/#{profile_id}/profile_ratings/#{@profile_rating.id}", :profile_id => profile_id, :html => {:method => :put} ) do |f|
  %span.big_star_rating{ :profile_id => profile_id, :avg_rating => avg_rating }
  = f.submit




/
  Le javascript
  \==================================================
/ Placed at the end of the document so the pages load faster
= javascript_include_tag "application"

/ This function has to be called AFTER the JS assests have been loaded!!
:javascript
  var rating_for_profile = $(function(profile_id, avg_rating) {
    $('.big_star_rating').raty({
      cancel:       false,
      half:         false,
      hintList:     ['I will NOT recommend', 'I am unlikely to recommend', 'OK', 'I might recommend', 'I will happily recommend to others'],
      size:         24,
      starOff:      'star-off-big.png',
      starOn:       'star-on-big.png',
      starHalf:     'star-half-big.png',
      start:        function() {
                      return $(this).attr('avg_rating');
                    },
    
      click: function(score, evt) {
        // alert('score: ' + score + '\nevent: ' + evt + '\nID: ' + $(this).attr('id') + 
        //         '\nprofile: ' + $(this).attr('profile_id')  + '\navg_rating: ' + $(this).attr('avg_rating') );
        return(score); 
          // , $(this).attr('profile_id') );
        // $('#lastresult').raty('start', score);

        // $.ajax({
        //   type: 'post',
        //   url:  $('#' + form_id).attr('action'),
        //   data: $('#' + form_id).serialize()
        // });
        
        // $.ajax({
        //   type: 'POST',
        //   url: '/SaveMyRating.php',
        //   data: {'score':score},
        //   success: function(data){ alert('Your rating was saved'); }         
        // });

      }

    });
  });

